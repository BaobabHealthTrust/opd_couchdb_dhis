<style type="text/css">
		form{
			margin: auto;
			background: #ffffff;
			color: #344351;
		}
		fieldset{
			width: 96%;
			margin:auto;
		}
		input, select ,option{
	        color:#1a2732 !important;
	    }
	    label{
	    	color: #344351;
	    }
	    #myModal
        {
            position : absolute;
              left: 20%;
              top: 25%;
              display: none;
        }    

</style>
<%= form_for @user do |f| %>
	
			<div class="form-group">
			    <label class="control-label col-sm-2" for="username">Username</label>
			    <div class="col-sm-10">
			      <input type="" class="form-control" id="username" name="user[username]" onblur="uniqueUsername()" placeholder="Username" required >
			    </div>
			  </div>
			  <div class="form-group">
			    <label class="control-label col-sm-2" for="first_name">Firstname</label>
			    <div class="col-sm-10">
			      <input type="first_name" class="form-control" id="first_name"  name="user[first_name]" placeholder="First name" required>
			    </div>
			  </div>
			  <div class="form-group">
			    <label class="control-label col-sm-2" for="last_name">Surname</label>
			    <div class="col-sm-10">
			      <input type="last_name" class="form-control" id="last_name"  name="user[last_name]" placeholder="Surname" required>
			    </div>
			  </div>
			  
			  </div>
			   <div class="form-group">
			    <label class="control-label col-sm-2" for="password">Password</label>
			    <div class="col-sm-10">
			      <input type="password" class="form-control"  name="user[plain_password]" id="password" required>
			    </div>
			  </div>
			  <div class="form-group">
			    <label class="control-label col-sm-2" for="confirm_password">Confirm Password</label>
			    <div class="col-sm-10">
			      <input type="password" class="form-control" id="confirm_password" onblur="matchPassword()" required>
			    </div>
			  </div>
			  <div class="form-group">
			    <label class="control-label col-sm-2" for="email"  name="user[email]">Email</label>
			    <div class="col-sm-10">
			      <input type="email" class="form-control" id="email" required>
			    </div>
			  </div>
			  
			  <div class="form-group">
			    <div class="col-sm-offset-2 col-sm-10">
			      <button class="btn btn-success pull-right">Save</button>
			    </div>
			  </div>
	</fieldset>
	
<%end%>
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" id="modal-title">Modal Header</h4>
      </div>
      <div class="modal-body">
        <p id="modal-message">Some text in the modal.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Ok</button>
      </div>
    </div>

  </div>
</div>
<script type="text/javascript">
		var validations = {};
     
         function uniqueUsername()
         {
         	var username = $("#username").val();

                
         	 data = {          
                      "username" : username }

              $.post("/confirm_username", data,function(response) 
              {
                console.log(response);
                  var response = JSON.parse(response).response;
                  if(response && eval(response)){
                   	                

                        showMessageModal("User Validation","Username already exist, please enter new username");

                         $("#username").focus();
                         $("#username").val('');


                  } 
              })

         }

		function matchPassword(){
			var password = $("#password").val();
			var confirm = $("#confirm_password").val();
			if(password == confirm){
				validations["Passwords don't match"] = true;
			}else{
				validations["Passwords don't match"]= false;
				showMessageModal("Password validation","Passwords don't match");
			}
		}
		function showMessageModal(title,message){
			$("#modal-title").html(title);
			$("#modal-message").html(message);
			$("#myModal").modal();
		}
		$(document).ready(function() {
		console.log(validations);
		  $('#new_user').on('submit', function(e){
		    var valid;
		    var validations_keys = Object.keys(validations);
		    console.log(validations_keys);
		    for (var i = 0 ;i < validations_keys.length ; i++){
		    	if(validations[validations_keys[i]]){
		    		valid = true;
		    	}
		    	else{
		    		valid =false;
		    		showMessageModal("Password validation",validations_keys[i]);
		    		break;
		    	}
		    }
		    if(valid) {
		      
		    }else{
		    	e.preventDefault();
		    }
		  });
		});
</script>