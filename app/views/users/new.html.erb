
<style type="text/css">
		form{
			margin: auto;
			background: #ffffff;
			color: #344351;
		}
		fieldset{
			width: 96%;
			margin:auto;
		}
		input, select ,option{
	        color:#1a2732 !important;
	    }
	    label{
	    	color: #344351;
	    }
	    /* topography */

	    h1 {
		  font-size: 3em;
		  letter-spacing: -2px;
		  margin-bottom: 30px;
		  text-align: center;
		}

	    /* form */

		input, textarea, select, .uneditable-input {
		  border: 1px solid #bbb;
		  width: 100%;
		  margin-bottom: 15px;

		}

		input {
		  height: auto !important;
		}

	    #myModal
        {
            position : absolute;
              left: 20%;
              top: 25%;
              display: none;
        }    

</style>
<h1>Create User </h1>

<div class="row">
 <div class="col-md-6 col-md-offset-3">
  <%= form_for @user, :url => '/users/create' ,:method => :post do |f| %>
   
        



    <%= f.label :Username %>
  
    <input type="username" class="form-control" id="username"  name="user[username]" placeholder="Username" onblur="uniqueUsername()" required>

    <%= f.label :Name %>
    <input type="name" class="form-control" id="name"  name="user[name]" placeholder="Name" required>

    <%= f.label :Surname %>

    <input type="last_name" class="form-control" id="last_name"  name="user[last_name]" placeholder="Last_Name" required>

    <%= f.label :Email %>
  
    <input type="email" class="form-control" id="email"  name="user[email]" placeholder="Email" required>

    <%= f.label :password %>
    <input type="password" class="form-control"  name="user[password]" id="password" required>

    <%= f.label :confirm_password, "Confirm Password" %>
    <input type="password" class="form-control" id="confirm_password" name="user[confirm_password]" onblur="matchPassword()" required>
   

    <%= f.submit "Save User", class: "bt btn-primary" %>
    <% end %>
    	

    </div>


     <div id="myModal" class="modal fade" role="dialog">
       <div class="modal-dialog">
		    <!-- Modal content-->
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal">&times;</button>
	        <h4 class="modal-title" id="modal-title">Modal Header</h4>
	      </div>
	      <div class="modal-body">
	        <p id="modal-message">Some text in the modal.</p>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Ok</button>
	      </div>
	    </div>
	  </div>
     </div>

   <script type="text/javascript">
		var validations = {};
     
         function uniqueUsername()
         {
         	var username = $("#username").val();
         	 data = {          
                      "username" : username }

              $.post("/confirm_username", data,function(response) 
              {
                console.log(response);
                  var response = JSON.parse(response).response;
                  if(response && eval(response)){
                   	    showMessageModal("User Validation","Username already exist, please enter new username");

                         $("#username").focus();
                         $("#username").val('');
                  } 
              })

         }

		function matchPassword(){
			var password = $("#password").val();
			var confirm = $("#confirm_password").val();
			if(password == confirm){
				validations["Passwords don't match"] = true;
			}else{
				validations["Passwords don't match"]= false;
				showMessageModal("Password validation","Passwords don't match, Please enter a matching password");
			}
		}
		function showMessageModal(title,message){
			$("#modal-title").html(title);
			$("#modal-message").html(message);
			$("#myModal").modal();
		}
		

		$(document).ready(function() {
		console.log(validations);
		  $('#new_user').on('submit', function(e){
		    var valid;
		    var validations_keys = Object.keys(validations);
		    console.log(validations_keys);
		    for (var i = 0 ;i < validations_keys.length ; i++){
		    	if(validations[validations_keys[i]]){
		    		valid = true;
		    	}
		    	else{
		    		valid =false;
		    		showMessageModal("Password validation",validations_keys[i]);
		    		break;
		    	}
		    }
		    if(valid) {
		      
		    }else{
		    	e.preventDefault();
		    }
		  });
		});
</script>




